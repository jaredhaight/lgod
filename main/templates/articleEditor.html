{% extends "base.html" %}
{% block head %}
<link rel="stylesheet" href="/static/css/redactor.css" xmlns="http://www.w3.org/1999/html"
      xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html"/>
<script src="/static/js/redactor.min.js"></script>
<script src="/static/js/simplyCountable.js"></script>
<script type="text/javascript">
$(document).ready(
        function(){
            $('#editorBody').redactor({
                fixed: true,
                imageUpload: '{% url fileUpload %}',
                imageGetJson: '{% url recentFiles %}',
                {%  if not article.is_posted %}
                autosave: '/editor/{{ article.id }}/autosave/',
                interval: 5, // seconds
                {% endif %}
            });

            $('#editorSummary').simplyCountable({
                counter:            '#counter',
                countType:          'characters',
                wordSeparator:      ' ',
                maxCount:           150,
                strictMax:          true,
                countDirection:     'down',
                safeClass:          'safe',
                overClass:          'over',
                thousandSeparator:  ',',
                onOverCount:        function(count, countable, counter){},
                onSafeCount:        function(count, countable, counter){},
                onMaxCount:         function(count, countable, counter){}
            });

            {% if not article.is_posted %}
            window.setInterval(autosave, 5000);

            function autosave(){
                var summary = $('#editorSummary').val();
                var categories = $('#editorCategories').val();
                var type = $('#id_type').val();
                var dataString = {'summary':summary,'categories':categories};
                var jsonText = JSON.stringify(dataString);
                $.ajax({
                    type: 'POST',
                    url: '/editor/{{ article.id }}/autosave/',
                    data: jsonText,
                    success: saved
                });
            }

            function saved(){
                $('#editorSaved').show();
                $('#editorSaved').delay(500).fadeOut('slow');
            }
            {% endif %}
        }
);
</script>
{% endblock %}
{% block title %}<title> {% if status  == "new" %}New Article{% else %}{{ article.title }}{% endif %} - Live Geek or Die </title>{% endblock %}
{% block notice %}
<div class="editorWrap">
    <div class="row-fluid">
        <div class="span12">
            <div class="alert {% if status == 'not_ready' %}alert-warning {% else %} alert-info {% endif %}editorStatus">
                <p><strong>Article Status: {% if status == 'posted' %} Posted {% elif status == 'not_ready' %} Not ready to Post {% elif status == 'ready_to_post' %} Ready to Post {% elif status == 'new' %} New {% endif %}</p></strong>
                {% if errors %}
                    <ul>
                        {% for error in errors %}
                            <li>{{ error }}<br>
                        {% endfor %}
                    </ul>

                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block content %}
<div class="editorWrap">
    <form class="form" action="." enctype="multipart/form-data" method="post">
    <fieldset>
        <div class="row-fluid editorText">
            <div class="span8">
                {{ form.title_slug }}
                Title{% if form.title.errors %}
                    {%  for error in form.title.errors %}
                        <div class="editorErrors">{{ error }}</div>
                    {% endfor %}
                {% endif %} <br>
                {{ form.title }}<p>
                <div id="editorSummaryWrap">
                Summary <span id="summaryCounter" class="pull-right"><span id="counter">150</span> Characters Remaining</span>
                {% if form.summary.errors %}
                    {%  for error in form.summary.errors %}
                        <div class="editorErrors">{{ error }}</div>
                    {% endfor %}
                {% endif %} <br>
                {{ form.summary}}
                </div>
                Article Type
                {% if form.type.errors %}
                    {%  for error in form.type.errors %}
                        <div class="editorErrors">{{ error }}</div>
                    {% endfor %}
                {% endif %}<br>
                {{ form.type }}<p>
                <div id="editorImage">
                    {% if article.image %}
                        <img src="{{ article.image.small_thumbnail.URL }}">
                    {% else %}
                        <div class="nothumb">
                            <p>No Image Selected</p>
                        </div>
                    {% endif %}
                    <div>
                        <p><button name="pick_photo" type="submit" class="btn">Choose an existing Image</button><br></p>
                        <p><button id="new_photo_btn" name="new_photo" type="submit" class="btn">Upload a New Image</button></p>
                    </div>
                </div>
            </div>
            <div class="span4">
                Categories
                {% if form.categories.errors %}
                    {%  for error in form.categories.errors %}
                        <div class="editorErrors">{{ error }}</div>
                    {% endfor %}
                {% endif %}<br>
                {{ form.categories  }}
                <p class="categoryHelpText">You can select multiple categories by holding the shift (or command) key while making your selections.</p>

            </div>
        </div>
        <div class="row-fluid">
            <div class="span12 margintop1">
           {{ form.body }}
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12 margintop1">
                <div class="control-group well">
                    <div class="editorControls controls">
                    {% if status == 'ready_to_post' %}
                        <button id="post_btn" class="btn btn-primary" name="post_article" type="submit" value="Post"><i class="icon-ok-sign"></i> Post</button>
                        <button id="preview_btn" class="btn btn-info" name="preview_article" type="submit" value="Preview"><i class="icon-globe"></i> Preview</button>
                        <button id="draft_btn" class="btn btn-info" name="save_draft" type="submit" value="Save as Draft"><i class="icon-save"></i> Save as Draft</button>
                    {% endif %}
                    {% if status == 'not_ready' or status == 'new' %}
                        <button id="update_status" class="btn btn-primary" name="update_article" type="submit" value="Update Status"><i class="icon-refresh"></i> Update Article Status</button>
                        <button id="preview_btn" class="btn btn-info" name="preview_article" type="submit" value="Preview"><i class="icon-globe"></i> Preview</button>
                        <button id="draft_btn" class="btn btn-info" name="save_draft" type="submit" value="Save as Draft"><i class="icon-save"></i> Save as Draft</button>
                    {% endif %}
                    {% if status == 'posted' %}
                        <button id="unpublish_btn" class="btn btn-warning" name="unpost_article" type="submit" value="Un-Publish"><i class="icon-remove-sign"></i> Un-Publish</button>
                        <button id="save_btn" class="btn btn-primary" name="save_article" type="submit" value="Save"><i class="icon-save"></i> Save Changes</button>
                    {% endif %}
                    <button id="discard_btn" class="btn btn-danger" name="discard_article" type="submit" value="Discard Changes"><i class="icon-trash"></i> Discard Changes</button>
                    </div>
                </div>
            </div>
        </div>

    </form>
    </fieldset>
    <div id="editorSaved" class="row-fluid">
        <div class="span12">
            <i class="icon-save"></i>
        </div>
    </div>
</div>
{% endblock %}
{% block javascript %}
<script>
    $(function(){
        $(document).ready(function() {
        $('#id_title').keyup(function(){
            if ($("#id_title").val() != ""){
                $("#editorImage").slideDown(500);
            }
            });
        });
        $("#id_image").change(function(){
            if ($("#id_image").val() != ""){
                $("#photoEdit_btn").show();
                $("#editorImgTxt").addClass("editorErrors").html("Choose Save or Edit Photos to upload your image");
            }
        });
    });
</script>
{% endblock %}
