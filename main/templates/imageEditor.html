{% extends "base.html" %}
{% block head %}
    <script src="/static/js/jquery.Jcrop.min.js"></script>
    <link rel="stylesheet" href="/static/css/jquery.Jcrop.css" type="text/css" />

    <script language="Javascript">
    $(document).ready(
        function() {
            $('#fimage').Jcrop({
                onSelect: featCoords,
                onChange: featCoords,
                minSize:['{{ featuredType.width }}','{{ featuredType.height }}'],
            {% if featured.X2 %}
                setSelect:   [ {{ featured.X }}, {{ featured.Y }}, {{ featured.X2 }}, {{ featured.Y2 }} ],
            {% endif %}
                aspectRatio:3.75/1,
                trueSize: [{{ articleImage.image.width }},{{ articleImage.image.height }}]
            });
            $('#himage').Jcrop({
                onSelect: headerCoords,
                onChange: headerCoords,
                minSize:['{{ headerType.width }}','{{ headerType.height }}'],
            {% if header.X2 %}
                setSelect:   [ {{ header.X }}, {{ header.Y }}, {{ header.X2 }}, {{ header.Y2 }} ],
            {% endif %}
                aspectRatio:4/1,
                trueSize: [{{ articleImage.image.width }},{{ articleImage.image.height }}]
            });
            $('#timage').Jcrop({
                onSelect: thumbCoords,
                onChange: thumbCoords,
                minSize:['{{ thumbType.width }}','{{ thumbType.height }}'],
            {% if thumb.X2 %}
                setSelect:   [ {{ thumb.X }}, {{ thumb.Y }}, {{ thumb.X2 }}, {{ thumb.Y2 }} ],
            {% endif %}
                aspectRatio:1,
                trueSize: [{{ articleImage.image.width }},{{ articleImage.image.height }}]
            });
        });
    function featCoords(c)
    {
        jQuery('#{{ featuredType.id }}form').find('#X').val(c.x);
        jQuery('#{{ featuredType.id }}form').find('#Y').val(c.y);
        jQuery('#{{ featuredType.id }}form').find('#X2').val(c.x2);
        jQuery('#{{ featuredType.id }}form').find('#Y2').val(c.y2);
    };

    function headerCoords(c)
    {
        jQuery("#{{ headerType.id }}form").find("#X").val(c.x);
        jQuery("#{{ headerType.id }}form").find("#Y").val(c.y);
        jQuery("#{{ headerType.id }}form").find("#X2").val(c.x2);
        jQuery("#{{ headerType.id }}form").find("#Y2").val(c.y2);
    };

    function thumbCoords(c)
    {
        jQuery("#{{ thumbType.id }}form").find("> #X").val(c.x);
        jQuery("#{{ thumbType.id }}form").find("> #Y").val(c.y);
        jQuery("#{{ thumbType.id }}form").find("> #X2").val(c.x2);
        jQuery("#{{ thumbType.id }}form").find("> #Y2").val(c.y2);
    };

    $(document).ready(function() {
        $('body').mouseup(function(){
            if ($("#{{ thumbType.id }}form").find("> #X2").val() - $("#{{ thumbType.id }}form").find("> #X").val() != 0){
                $("#thumbtab").addClass('imgEditorGood');
                var thumbgood = true
            } else {
                $("#thumbtab").removeClass('imgEditorGood');
                var thumbgood = false
            }

            if ($("#{{ headerType.id }}form").find("> #X2").val() - $("#{{ headerType.id }}form").find("> #X").val() != 0){
                $("#headertab").addClass('imgEditorGood');
                var headergood = true
            } else {
                $("#headertab").removeClass('imgEditorGood');
                var headergood = false
            }

            if ($("#{{ featuredType.id }}form").find("> #X2").val() - $("#{{ featuredType.id }}form").find("> #X").val() != 0){
                $("#featuredtab").addClass('imgEditorGood');
                var featuredgood = true
            } else {
                $("#featuredtab").removeClass('imgEditorGood');
                var featuredgood = false
            }

            if (thumbgood && headergood && featuredgood){
                $('#saveButton').show();
            } else {
                $('#saveButton').hide();
            }
        });
    });
    </script>
{% endblock %}
{% block title %}<title> Image Editor - Live Geek or Die </title>{% endblock %}

{% block content %}
    {% if form.errors %}
        <div class="row-fluid">
            <div class="span12">
                {% for field in form %}
                    {% if field.errors %}
                        {{ field.name }}-{{ field.errors }}<p>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endif %}
    <div class="row-fluid">
        <div class="span12 margintop1">
            <div class="tabbable">
                <form action="/staff/image/{{ articleImage.id }}/{% if article_id %}?article={{ article_id }}{% endif %}" method="post">
                    {% csrf_token %}
                <ul class="nav nav-tabs">
                    <li id="featuredtab" class="active"><a href="#featured" data-toggle="tab">Featured</a></li>
                    <li id="headertab"><a href="#header" data-toggle="tab">Header</a></li>
                    <li id="thumbtab"><a href="#thumbnail" data-toggle="tab">Thumbnail</a></li>
                    <button id="saveButton" type="submit" name="submit" class="btn btn-primary pull-right">Save Image Selection</button>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="featured">
                        <div class="row-fluid imageEditorCrop">
                            <div class="span12">
                                <img id="fimage" src="{{ articleImage.image.url }}" width="1140" height="{{ imgheight }}">
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="header">
                        <div class="row-fluid">
                            <div class="span12 imageEditorCrop">
                                <img id="himage" src="{{ articleImage.image.url }}" width="1140" height="{{ imgheight }}">
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="thumbnail">
                        <div class="row-fluid">
                            <div class="span12 imageEditorCrop">
                                <img id="timage" src="{{ articleImage.image.url }}" width="1140" height="{{ imgheight }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                {{ formset.management_form }}
            {% for form in formset %}
                <div id="{{ form.type.value }}form" class="span2">
                    {{ form }}
                </div>
            {% endfor %}
            </div>
        </div>
    </div>
    </form>
{% endblock %}

