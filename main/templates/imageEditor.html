{% extends "base.html" %}
{% block head %}
    <script src="/static/js/jquery.Jcrop.min.js"></script>
    <link rel="stylesheet" href="/static/css/jquery.Jcrop.css" type="text/css" />

    <script language="Javascript">
    $(document).ready(
        function() {
            $('#fimage').Jcrop({
                onSelect: featCoords,
                onChange: featCoords,
                minSize:['{{ headerType.width }}','{{ headerType.height }}'],
            {% if header.X2 %}
                setSelect:   [ {{ header.X }}, {{ header.Y }}, {{ header.X2 }}, {{ header.Y2 }} ],
            {% endif %}
                aspectRatio:3.75/1,
                trueSize: [{{ articleImage.image.width }},{{ articleImage.image.height }}]
            });
            $('#sfimage').Jcrop({
                onSelect: smallFeatCoords,
                onChange: smallFeatCoords,
                minSize:['{{ thumbnailType.width }}','{{ thumbnailType.height }}'],
            {% if thumbnail.X2 %}
                setSelect:   [ {{ thumbnail.X }}, {{ thumbnail.Y }}, {{ thumbnail.X2 }}, {{ thumbnail.Y2 }} ],
            {% endif %}
                aspectRatio:1.66667/1,
                trueSize: [{{ articleImage.image.width }},{{ articleImage.image.height }}]
            });
        });
    function featCoords(c)
    {
        jQuery('#{{ headerType.id }}form').find('#X').val(c.x);
        jQuery('#{{ headerType.id }}form').find('#Y').val(c.y);
        jQuery('#{{ headerType.id }}form').find('#X2').val(c.x2);
        jQuery('#{{ headerType.id }}form').find('#Y2').val(c.y2);
    };

    function smallFeatCoords(c)
    {
        jQuery("#{{ thumbnailType.id }}form").find("#X").val(c.x);
        jQuery("#{{ thumbnailType.id }}form").find("#Y").val(c.y);
        jQuery("#{{ thumbnailType.id }}form").find("#X2").val(c.x2);
        jQuery("#{{ thumbnailType.id }}form").find("#Y2").val(c.y2);
    };

    $(document).ready(function() {
        $('body').mouseup(function(){
            if ($("#{{ thumbnailType.id }}form").find("> #X2").val() - $("#{{ thumbnailType.id }}form").find("> #X").val() != 0){
                $("#smalltab").addClass('imgEditorGood');
                var smallgood = true
            } else {
                $("#smalltab").removeClass('imgEditorGood');
                var smallgood = false
            }

            if ($("#{{ headerType.id }}form").find("> #X2").val() - $("#{{ headerType.id }}form").find("> #X").val() != 0){
                $("#headertab").addClass('imgEditorGood');
                var featuredgood = true
            } else {
                $("#headertab").removeClass('imgEditorGood');
                var featuredgood = false
            }

            if (smallgood && featuredgood){
                $('#saveButton').show();
            } else {
                $('#saveButton').hide();
            }
        });
    });
    </script>
{% endblock %}
{% block title %}<title> Image Editor - Live Geek or Die </title>{% endblock %}

{% block content %}
    {% if form.errors %}
        <div class="row-fluid">
            <div class="span12">
                {% for field in form %}
                    {% if field.errors %}
                        {{ field.name }}-{{ field.errors }}<p>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endif %}
    <div class="row-fluid">
        <div class="span12 margintop1">
            <div class="tabbable">
                <form action="/staff/image/{{ articleImage.id }}/{% if article_id %}?article={{ article_id }}{% endif %}" method="post">
                    {% csrf_token %}
                <ul class="nav nav-tabs">
                    <li id="headertab" class="active"><a href="#header" data-toggle="tab">Header Crop</a></li>
                    <li id="smalltab"><a href="#thumbnail" data-toggle="tab">Square Crop</a></li>
                    <button id="saveButton" type="submit" name="submit" class="btn btn-primary pull-right">Save Image Selection</button>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="header">
                        <div class="row-fluid imageEditorCrop">
                            <div class="span12">
                                <img id="fimage" src="{{ articleImage.image.url }}" width="1140" height="{{ imgheight }}">
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="thumbnail">
                        <div class="row-fluid">
                            <div class="span12 imageEditorCrop">
                                <img id="sfimage" src="{{ articleImage.image.url }}" width="1140" height="{{ imgheight }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                {{ formset.management_form }}
            {% for form in formset %}
                <div id="{{ form.type.value }}form" class="span2">
                    {{ form }}
                </div>
            {% endfor %}
            </div>
        </div>
    </div>
    </form>
{% endblock %}

