{% extends "base.html" %}
{% block head %}
    <script src="/static/js/jquery.Jcrop.min.js"></script>
    <link rel="stylesheet" href="/static/css/jquery.Jcrop.css" type="text/css" />

    <script language="Javascript">
    $(document).ready(
        function() {
            $('#fimage').Jcrop({
                onSelect: featCoords,
                onChange: featCoords,
                minSize:['{{ featuredType.width }}','{{ featuredType.height }}'],
            {% if featured.X2 %}
                setSelect:   [ {{ featured.X }}, {{ featured.Y }}, {{ featured.X2 }}, {{ featured.Y2 }} ],
            {% endif %}
                aspectRatio:3.75/1,
                trueSize: [{{ articleImage.image.width }},{{ articleImage.image.height }}]
            });
            $('#sfimage').Jcrop({
                onSelect: smallFeatCoords,
                onChange: smallFeatCoords,
                minSize:['{{ smallFeaturedType.width }}','{{ smallFeaturedType.height }}'],
            {% if smallFeatured.X2 %}
                setSelect:   [ {{ smallFeatured.X }}, {{ smallFeatured.Y }}, {{ smallFeatured.X2 }}, {{ smallFeatured.Y2 }} ],
            {% endif %}
                aspectRatio:1/1,
                trueSize: [{{ articleImage.image.width }},{{ articleImage.image.height }}]
            });
        });
    function featCoords(c)
    {
        jQuery('#{{ featuredType.id }}form').find('#X').val(c.x);
        jQuery('#{{ featuredType.id }}form').find('#Y').val(c.y);
        jQuery('#{{ featuredType.id }}form').find('#X2').val(c.x2);
        jQuery('#{{ featuredType.id }}form').find('#Y2').val(c.y2);
    };

    function smallFeatCoords(c)
    {
        jQuery("#{{ smallFeaturedType.id }}form").find("#X").val(c.x);
        jQuery("#{{ smallFeaturedType.id }}form").find("#Y").val(c.y);
        jQuery("#{{ smallFeaturedType.id }}form").find("#X2").val(c.x2);
        jQuery("#{{ smallFeaturedType.id }}form").find("#Y2").val(c.y2);
    };

    $(document).ready(function() {
        $('body').mouseup(function(){
            if ($("#{{ smallFeaturedType.id }}form").find("> #X2").val() - $("#{{ smallFeaturedType.id }}form").find("> #X").val() != 0){
                $("#smalltab").addClass('imgEditorGood');
                var smallgood = true
            } else {
                $("#smalltab").removeClass('imgEditorGood');
                var smallgood = false
            }

            if ($("#{{ featuredType.id }}form").find("> #X2").val() - $("#{{ featuredType.id }}form").find("> #X").val() != 0){
                $("#featuredtab").addClass('imgEditorGood');
                var featuredgood = true
            } else {
                $("#featuredtab").removeClass('imgEditorGood');
                var featuredgood = false
            }

            if (smallgood && featuredgood){
                $('#saveButton').show();
            } else {
                $('#saveButton').hide();
            }
        });
    });
    </script>
{% endblock %}
{% block title %}<title> Image Editor - Live Geek or Die </title>{% endblock %}

{% block content %}
    {% if form.errors %}
        <div class="row-fluid">
            <div class="span12">
                {% for field in form %}
                    {% if field.errors %}
                        {{ field.name }}-{{ field.errors }}<p>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endif %}
    <div class="row-fluid">
        <div class="span12 margintop1">
            <div class="tabbable">
                <form action="/staff/image/{{ articleImage.id }}/{% if article_id %}?article={{ article_id }}{% endif %}" method="post">
                    {% csrf_token %}
                <ul class="nav nav-tabs">
                    <li id="featuredtab" class="active"><a href="#featured" data-toggle="tab">Featured</a></li>
                    <li id="smalltab"><a href="#smallFeatured" data-toggle="tab">Square Crop</a></li>
                    <button id="saveButton" type="submit" name="submit" class="btn btn-primary pull-right">Save Image Selection</button>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="featured">
                        <div class="row-fluid imageEditorCrop">
                            <div class="span12">
                                <img id="fimage" src="{{ articleImage.image.url }}" width="1140" height="{{ imgheight }}">
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="smallFeatured">
                        <div class="row-fluid">
                            <div class="span12 imageEditorCrop">
                                <img id="sfimage" src="{{ articleImage.image.url }}" width="1140" height="{{ imgheight }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                {{ formset.management_form }}
            {% for form in formset %}
                <div id="{{ form.type.value }}form" class="span2">
                    {{ form }}
                </div>
            {% endfor %}
            </div>
        </div>
    </div>
    </form>
{% endblock %}

